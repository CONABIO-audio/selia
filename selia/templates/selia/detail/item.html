{% extends 'selia/detail/base.html' %}
{% load i18n %}
{% load selia_tags %}
{% load selia_buttons %}

{% block secondary-navbar %}
  {% include 'selia/navbars/item.html' %}
{% endblock secondary-navbar %}

{% block toolbar-title %}{{ item.collection }}{% trans ': Item ' %} {{ item.pk }}{% endblock %}

{% block toolbar-items %}
  <li class="nav-item">
    <a class="nav-link" href="#">{% trans 'Download summary' %} <i class="fas fa-download"></i></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">{% trans 'Help' %} <i class="fas fa-question"></i></a>
  </li>
  {% if prev_object %}
    <li class="nav-item">
      <a class="nav-link" href="{% url 'selia:item_detail' prev_object.pk %}?"><i class="fas fa-chevron-left"></i>{% trans 'Item ' %}{{ prev_object.pk }}</a>
    </li>
  {% endif %}
  {% if next_object %}
    <li class="nav-item">
      <a class="nav-link" href="{% url 'selia:item_detail' next_object.pk %}?">
        {% trans 'Item ' %}{{ next_object.pk }}<i class="fas fa-chevron-right"></i>
      </a>
    </li>
  {% endif %}
{% endblock toolbar-items %}


{% block main-content %}
<div class="row p-4">
  <div class="col-6">
    <div class="row p-2">
      {% detail_component detail_template=detail_template object=item %}
    </div>
    <div class="row p-2">
      {% summary_component summary_template=summary_template object=item %}
    </div>
  </div>
  <div class="col-6">
    <div class="row p-2">
      {% viewer_component viewer_template=viewer_template object=item %}
    </div>
  </div>
</div>

{% endblock main-content %}

{% block scripts-extra %}
{% autocomplete_media %}
{{ block.super }}
  <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
  <script src="{{ visualizer_url }}" type="text/javascript"></script>
  <script type="text/javascript">
    var config = {
      canvas: document.getElementById('visualizerCanvas'),
      active: true,
      itemInfo: {
        url: "{% url 'irekua_rest_api:item-detail' item.pk %}download",
      }
    }

    var isLoaded = false;
    var visualizer;

    $('#visualizerModal').on('shown.bs.modal', function (e) {
      if (!(isLoaded)) {
        visualizer = new Visualizer.default(config)

        visualizer.init();

        ReactDOM.render(
            visualizer.renderToolbar(),
            document.getElementById('toolbar'),
            () => {
              visualizer.adjustSize();
              visualizer.draw();
            });
          return;
      }

      visualizer.init();
      visualizer.adjustSize();
      visualizer.draw();
    });
  </script>
{% endblock %}
